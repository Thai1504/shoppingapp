<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Qu·∫£n L√Ω Mua S·∫Øm Kh√°ch S·∫°n v3.0</title>
    <link rel="stylesheet" href="css/styles.css">
    <meta name="description" content="·ª®ng d·ª•ng qu·∫£n l√Ω mua s·∫Øm cho 4 kh√°ch s·∫°n - Phi√™n b·∫£n 3.0">
    <meta name="theme-color" content="#16a34a">
</head>
<body>
    <!-- Loading indicator -->
    <div id="loadingIndicator" class="loading">
        <div class="loading-spinner"></div>
        <p>ƒêang t·∫£i...</p>
    </div>

    <div class="container">

        <!-- Compact Navigation -->
        <div class="sticky-nav" id="stickyNav">
            <!-- Row 1: Date and Hotel -->
            <div class="nav-row nav-row-compact">
                <input type="date" id="selectedDate" class="nav-input" required>
                <select id="hotelSelect" class="nav-select">
                    <option value="">-- Ch·ªçn kh√°ch s·∫°n --</option>
                    <option value="36LS">Kh√°ch s·∫°n 36LS</option>
                    <option value="16TX">Kh√°ch s·∫°n 16TX</option>
                    <option value="55HT">Kh√°ch s·∫°n 55HT</option>
                    <option value="49HG">Kh√°ch s·∫°n 49HG</option>
                </select>
            </div>

            <!-- Row 2: Categories and Actions -->
            <div class="nav-row nav-row-compact">
                <div class="section-tabs">
                    <button class="section-tab" data-section="thit">
                        Th·ªãt
                    </button>
                    <button class="section-tab" data-section="rau">
                        Rau c·ªß
                    </button>
                    <button class="section-tab" data-section="dokho">
                        ƒê·ªì kh√¥
                    </button>
                </div>
            </div>
        </div>

        <!-- Search and Filter Section -->
        <div class="search-section" id="searchSection">
            <input type="text" id="searchInput" class="search-input" placeholder="T√¨m ki·∫øm s·∫£n ph·∫©m...">
            <select id="statusFilter" class="filter-select">
                <option value="all">T·∫•t c·∫£</option>
                <option value="pending">Ch∆∞a ho√†n th√†nh</option>
                <option value="done">ƒê√£ ho√†n th√†nh</option>
            </select>
        </div>

        <!-- Items List -->
        <div class="items-list" id="itemsList">

            <!-- Items Table -->
            <div class="table-container">
                <table class="items-table" id="itemsTable">
                    <thead>
                        <tr>
                            <th class="col-controls">‚úì</th>
                            <th class="col-name-unit">S·∫£n ph·∫©m</th>
                            <th class="col-price edit-mode-only" style="display: none;">Gi√° mua (k‚Ç´)</th>
                            <th class="col-price edit-mode-only" style="display: none;">Gi√° b√°n (k‚Ç´)</th>
                            <th class="col-total">T·ªïng mua (k‚Ç´)</th>
                            <th class="col-total">T·ªïng b√°n (k‚Ç´)</th>
                        </tr>
                    </thead>
                    <tbody id="itemsTableBody">
                        <!-- Items will be populated here -->
                    </tbody>
                    <tfoot id="itemsTableFooter" style="display: none;">
                        <tr class="totals-row">
                            <td class="totals-label">
                                <strong>T·ªîNG</strong>
                            </td>
                            <td class="totals-summary">
                                <strong id="itemCount">0 s·∫£n ph·∫©m</strong>
                            </td>
                            <td class="totals-price edit-mode-only" style="display: none;">
                                <!-- Price columns space -->
                            </td>
                            <td class="totals-price edit-mode-only" style="display: none;">
                                <!-- Price columns space -->
                            </td>
                            <td class="totals-buy">
                                <strong id="totalBuyAmount">0 k‚Ç´</strong>
                            </td>
                            <td class="totals-sell">
                                <strong id="totalSellAmount">0 k‚Ç´</strong>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üì¶</div>
                <h4>Ch∆∞a c√≥ s·∫£n ph·∫©m n√†o</h4>
                <p>H√£y th√™m s·∫£n ph·∫©m ƒë·∫ßu ti√™n v√†o danh s√°ch!</p>
            </div>
        </div>
    </div>


    <!-- Fixed Footer -->
    <div class="fixed-footer" id="fixedFooter" style="display: none;">
        <div class="footer-content">
            <div class="footer-totals">
                <span id="footerItemCount">0 s·∫£n ph·∫©m</span>
                <span id="footerTotalBuy">0 k‚Ç´</span>
                <span id="footerTotalSell">0 k‚Ç´</span>
            </div>
            <div class="footer-actions">
                <button id="addItemBtn" class="btn btn-primary" title="Th√™m s·∫£n ph·∫©m">
                    ‚ûï Th√™m s·∫£n ph·∫©m
                </button>
                <button id="printBtnFooter" class="btn btn-print" title="In danh s√°ch" style="display: none;">
                    üñ®Ô∏è In
                </button>
                <button id="exportBtnFooter" class="btn btn-export" title="Xu·∫•t file" style="display: none;">
                    üìÑ Xu·∫•t
                </button>
            </div>
        </div>
    </div>

    <!-- Add Item Modal -->
    <div class="modal add-item-modal" id="addItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</h3>
                <button class="modal-close" id="modalClose">&times;</button>
            </div>
            
            <form id="itemForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Ch·ªçn t·ª´ danh s√°ch c√≥ s·∫µn:</label>
                        <select id="itemPool" class="form-select">
                            <option value="">-- Ch·ªçn t·ª´ danh s√°ch --</option>
                        </select>
                    </div>
                </div>

                <div class="form-row form-row-compact">
                    <div class="form-group form-group-name">
                        <label>T√™n s·∫£n ph·∫©m</label>
                        <input type="text" id="itemName" class="form-input" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" required>
                    </div>
                    <div class="form-group form-group-quantity">
                        <label>S·ªë l∆∞·ª£ng</label>
                        <input type="number" id="quantity" class="form-input" value="1" step="0.1" min="0" placeholder="S·ªë l∆∞·ª£ng" required>
                    </div>
                    <div class="form-group form-group-unit">
                        <label>ƒê∆°n v·ªã</label>
                        <select id="unit" class="form-select" required>
                            <option value="kg">kg</option>
                            <option value="gram">gram</option>
                            <option value="l√≠t">l√≠t</option>
                            <option value="chai">chai</option>
                            <option value="g√≥i">g√≥i</option>
                            <option value="c√°i">c√°i</option>
                            <option value="th√πng">th√πng</option>
                            <option value="h·ªôp">h·ªôp</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Gi√° mua (k‚Ç´)</label>
                        <input type="number" id="buyPrice" class="form-input" placeholder="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Gi√° b√°n (k‚Ç´)</label>
                        <input type="number" id="sellPrice" class="form-input" placeholder="0" min="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="saveToPool" class="form-checkbox">
                            L∆∞u v√†o danh m·ª•c s·∫£n ph·∫©m ƒë·ªÉ d√πng l·∫°i
                        </label>
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">
                        ‚ûï Th√™m s·∫£n ph·∫©m
                    </button>
                    <button type="button" id="clearFormBtn" class="btn btn-secondary">
                        üóëÔ∏è X√≥a form
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Item Modal -->
    <div class="modal edit-item-modal" id="editItemModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚úèÔ∏è Ch·ªânh s·ª≠a s·∫£n ph·∫©m</h3>
                <button class="modal-close" id="editModalClose">&times;</button>
            </div>
            
            <form id="editItemForm" class="modal-form">
                <input type="hidden" id="editItemId">
                
                <div class="form-row form-row-compact">
                    <div class="form-group form-group-name">
                        <label>T√™n s·∫£n ph·∫©m</label>
                        <input type="text" id="editItemName" class="form-input" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m" required>
                    </div>
                    <div class="form-group form-group-quantity">
                        <label>S·ªë l∆∞·ª£ng</label>
                        <input type="number" id="editQuantity" class="form-input" step="0.1" min="0" placeholder="S·ªë l∆∞·ª£ng" required>
                    </div>
                    <div class="form-group form-group-unit">
                        <label>ƒê∆°n v·ªã</label>
                        <select id="editUnit" class="form-select" required>
                            <option value="kg">kg</option>
                            <option value="gram">gram</option>
                            <option value="l√≠t">l√≠t</option>
                            <option value="chai">chai</option>
                            <option value="g√≥i">g√≥i</option>
                            <option value="c√°i">c√°i</option>
                            <option value="th√πng">th√πng</option>
                            <option value="h·ªôp">h·ªôp</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Gi√° mua (k‚Ç´)</label>
                        <input type="number" id="editBuyPrice" class="form-input" placeholder="0" min="0">
                    </div>
                    <div class="form-group">
                        <label>Gi√° b√°n (k‚Ç´)</label>
                        <input type="number" id="editSellPrice" class="form-input" placeholder="0" min="0">
                    </div>
                </div>

                <div class="modal-actions">
                    <button type="submit" class="btn btn-primary">
                        üíæ L∆∞u thay ƒë·ªïi
                    </button>
                    <button type="button" id="editCancelBtn" class="btn btn-secondary">
                        ‚ùå H·ªßy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Cleanup Modal -->
    <div class="modal cleanup-modal" id="cleanupModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üóëÔ∏è D·ªçn d·∫πp d·ªØ li·ªáu c≈©</h3>
                <button class="modal-close" id="cleanupModalClose">&times;</button>
            </div>
            
            <form id="cleanupForm" class="modal-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>T·ª´ ng√†y:</label>
                        <input type="date" id="cleanupFromDate" class="form-input" required>
                    </div>
                    <div class="form-group">
                        <label>ƒê·∫øn ng√†y:</label>
                        <input type="date" id="cleanupToDate" class="form-input" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="quick-select">
                        <button type="button" class="btn btn-secondary btn-sm" onclick="app.setCleanupRange(30)">1 th√°ng tr∆∞·ªõc</button>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="app.setCleanupRange(90)">3 th√°ng tr∆∞·ªõc</button>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="app.setCleanupRange(180)">6 th√°ng tr∆∞·ªõc</button>
                    </div>
                </div>

                <div class="cleanup-preview">
                    <p id="cleanupPreview">Ch·ªçn kho·∫£ng ng√†y ƒë·ªÉ xem tr∆∞·ªõc d·ªØ li·ªáu s·∫Ω b·ªã x√≥a</p>
                </div>

                <div class="modal-actions">
                    <button type="button" id="previewCleanupBtn" class="btn btn-secondary">
                        üëÅÔ∏è Xem tr∆∞·ªõc
                    </button>
                    <button type="submit" id="executeCleanupBtn" class="btn btn-danger" disabled>
                        üóëÔ∏è X√≥a d·ªØ li·ªáu
                    </button>
                    <button type="button" id="cleanupCancelBtn" class="btn btn-secondary">
                        ‚ùå H·ªßy
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Print Preview Modal -->
    <div class="modal" id="printPreviewModal">
        <div class="modal-content print-preview-modal">
            <div class="modal-header">
                <h3>üëÅÔ∏è Xem tr∆∞·ªõc danh s√°ch in</h3>
                <button class="modal-close" id="printPreviewClose">&times;</button>
            </div>
            
            <div class="print-preview-content">
                <div class="preview-instructions">
                    <p><strong>üìã Danh s√°ch s·∫Ω ƒë∆∞·ª£c in theo ƒë·ªãnh d·∫°ng ngang A4 v·ªõi 3 c·ªôt:</strong></p>
                    <ul>
                        <li>ü•© Th·ªãt & Gia C·∫ßm</li>
                        <li>ü•¨ Rau C·ªß Qu·∫£</li>
                        <li>üåæ ƒê·ªì Kh√¥ & Gia V·ªã</li>
                    </ul>
                    <div class="preview-actions">
                        <button id="confirmPrintBtn" class="btn btn-primary">üñ®Ô∏è Ti·∫øp t·ª•c in</button>
                        <button id="exportPreviewBtn" class="btn btn-export">üìÑ Xu·∫•t file HTML</button>
                        <button id="cancelPreviewBtn" class="btn btn-secondary">‚ùå H·ªßy</button>
                    </div>
                </div>
                
                <div class="print-preview-container">
                    <div id="printPreviewContent" class="print-preview-iframe">
                        <!-- Preview content will be inserted here -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Confirmation Modal -->
    <div class="modal" id="confirmModal">
        <div class="modal-content">
            <h3 id="confirmTitle">X√°c nh·∫≠n</h3>
            <p id="confirmMessage">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën th·ª±c hi·ªán h√†nh ƒë·ªông n√†y?</p>
            <div class="modal-actions">
                <button id="confirmYes" class="btn btn-primary">C√≥</button>
                <button id="confirmNo" class="btn btn-secondary">Kh√¥ng</button>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Hidden file input for import -->
    <input type="file" id="fileInput" accept=".json" style="display: none;">

    <!-- Scripts -->
    <script src="js/utils.js"></script>
    <script src="js/data.js"></script>
    <script src="js/app.js"></script>
</body>
</html>